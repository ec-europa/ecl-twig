{% spaceless %}

{#
  Parameters:
    - "icon_file_path" (string) (default: ''): URL to icons file
    - "logo" (associative array) (default: predefined structure): Logo image settings. format:
        {
          "title": (string) (default: ''): Logo title attribute.
          "alt": (string) (default: ''): Logo alt attribute.
          "href": (string) (default: ''): Logo URL.
          "src": (string) (default: ''): Logo image file path, eg. dist/images/logo--en.svg.
        },
    - "language_selector" (associative array) (default: predefined structure): Language switcher settings. format:
        {
          "href": (string) (default: ''): URL for switcher
          "name": (string) (default: ''): Switcher language label, eg. 'English', 'Français', etc.
          "code": (string) (default: ''): Switcher language code, eg. 'en', 'fr', etc.
          "overlay" (associative array) (default: predefined structure): Overlay language switcher settings. format:
            {
              "close_label": (string) (default: ''): Close button label eg. 'Close'.
              "title": (string) (default: ''): Overlay title, eg. 'Select your language'.
              "items": (array) (default: []): (array) (default: []): format: [
                {
                  "lang" (string) (default: '') Item language code, eg. 'en', 'fr', etc.
                  "label" (string) (default: '') Item language label, eg. 'English', 'Français', etc.
                  "href" (string) (default: '') Item language URL eg. '/example#language_en'.
                  "is_active" (boolean) (default: false) define if item is the active language.
                },
              ],
            },
        },
    - "search_form" (associative array) (default: predefined structure): EC Search Form component structure
    - "auto_init" (boolean) (default: true)
    - "extra_classes" (string) (default: '')
    - "extra_attributes" (array) (default: []): format: [
        {
          "name" (string) (default: ''),
          "value" (string) (default: '')
        },
        ...
      ]

#}

{# Default variables #}

{% set _logo = logo|default({}) %}
{% set _language_selector = language_selector|default({}) %}
{% set _icon_file_path = icon_file_path|default('') %}
{% set _auto_init = auto_init|default(true) %}

{% set _search_form = {
  text_input: {
    id: 'input-search',
    name: 'search',
    extra_classes: 'ecl-search-form__text-input'
  },
  button: {
    variant: 'search',
    icon: {
      type: 'general',
      name: 'search',
      path: _icon_file_path,
      size: 'fluid',
    },
    label: 'Search',
    extra_classes: 'ecl-search-form__button'
  },
  extra_classes: 'ecl-site-header__search'
}
%}

{% set _item_link_active_icon = {
  type: 'ui',
  name: 'check',
  path: _icon_file_path,
  size: 'xs',
}
%}

{% set _css_class = 'ecl-site-header' %}

{% set _extra_attributes = ['data-ecl-site-header="true"'] %}
{% if _auto_init %}
  {% set _extra_attributes = _extra_attributes|merge(['data-ecl-auto-init="SiteHeader"']) %}
{% endif %}
{% set _extra_attributes = _extra_attributes|join(' ') %}

{# Merge options #}

{% if logo is defined and logo is not empty %}
  {% set _logo = _logo|merge(logo) %}
{% endif %}

{% if language_selector is defined and language_selector is not empty %}
  {% set _language_selector = _language_selector|merge(language_selector) %}
{% endif %}

{% if search_form.text_input is defined and search_form.text_input is not empty %}
  {% set _search_form = _search_form|merge({ text_input: _search_form.text_input|merge(search_form.text_input) }) %}
{% endif %}

{% if search_form.button is defined and search_form.button is not empty %}
  {% set _search_form = _search_form|merge({ button: _search_form.button|merge(search_form.button) }) %}
{% endif %}

{# Internal logic - Process properties #}

{% set _total_items = _language_selector.overlay.items|length %}
{% set _items_per_columns = (_total_items / 2)|round(0, 'ceil')  %}

{% if extra_classes is defined and extra_classes is not empty %}
  {% set _css_class = _css_class ~ ' ' ~ extra_classes %}
{% endif %}

{% if extra_attributes is defined and extra_attributes is not empty and extra_attributes is iterable %}
  {% for attr in extra_attributes %}
    {% set _extra_attributes = _extra_attributes ~ ' ' ~ attr.name ~ '="' ~ attr.value ~ '"' %}
  {% endfor %}
{% endif %}

{# Print the result #}

<header class="{{ _css_class }}"{{ _extra_attributes|raw }}>
  <div class="ecl-site-header__container ecl-container">
    <div class="ecl-site-header__banner">
      <a 
        class="ecl-link ecl-link--standalone" 
        href="{{ _logo.url }}" 
        aria-label="{{ _logo.title }}"
      >
        <img 
          alt="{{ _logo.alt }}" 
          title="{{ _logo.title }}" 
          class="ecl-site-header__logo-image" 
          src="{{ _logo.src }}"
        />
      </a>
      <div class="ecl-site-header__selector">
        <a 
          class="ecl-link ecl-link--standalone ecl-site-header__selector-link" 
          href="{{ _language_selector.url }}"
          data-ecl-language-selector="true"
        >
          {{- _language_selector.name -}}
          <span class="ecl-site-header__language-icon">
            {% include '../ec-component-icon/icon.html.twig' with {
              icon: {
                path: _icon_file_path,
                type: 'general',
                name: 'language'
              }
            } only %}
            <span class="ecl-site-header__language-code">{{ _language_selector.code }}</span>
          </span>
        </a>

        <div 
          hidden 
          class="ecl-language-list ecl-language-list--overlay" 
          aria-labelledby="ecl-language-list__title" 
          role="dialog" 
          data-ecl-language-list-overlay="true"
        >
          <div class="ecl-language-list__container ecl-container">
            <div class="ecl-row">
              <div class="ecl-language-list__close ecl-col-12 ecl-col-lg-8 ecl-offset-lg-2">
               {% include '../ec-component-button/button.html.twig' with {
                  label: _language_selector.overlay.close_label,
                  variant: 'ghost',
                  type: 'submit',
                  icon: {
                    path: _icon_file_path,
                    type: 'ui',
                    name: 'close',
                    size: 's'
                  },
                  icon_position: "after",
                  extra_classes: 'ecl-language-list__close-button',
                  extra_attributes: [
                    { name: 'data-ecl-language-list-close', value: true },
                  ],
                } only %}
              </div>

              <div class="ecl-language-list__title ecl-col-12 ecl-col-lg-8 ecl-offset-lg-2" id="ecl-language-list__title">
                {% include '../ec-component-icon/icon.html.twig' with {
                  icon: {
                    path: _icon_file_path,
                    type: 'general',
                    name: 'generic-lang',
                  },
                  extra_classes: 'ecl-language-list__title-icon',
                } only %}
                {{- _language_selector.overlay.title -}}
              </div>
            </div>
            <div class="ecl-row">
              {% if _language_selector.overlay.items is not empty %}
                {% for row in _language_selector.overlay.items|batch(_items_per_columns) %}
                  <div class="ecl-language-list__column ecl-col-12 ecl-col-lg-4{{ loop.index == 1 ? ' ecl-offset-lg-2' }}">
                    <ul class="ecl-language-list__list">
                      {% for column in row %}
                        <li class="ecl-language-list__item{{ column.is_active ? '  ecl-language-list__item--is-active' }}">
                          {% include '../ec-component-link/link.html.twig' with { 
                            link: { 
                              type: 'standalone', 
                              label: column.lang, 
                              path: column.href, 
                              icon_position: 'after',
                            }, 
                            icon: column.is_active ? _item_link_active_icon : {},
                            extra_classes: 'ecl-language-list__link', 
                            extra_attributes: [ 
                              { name: 'lang', value: column.lang }, 
                              { name: 'hrefLang', value: column.lang },
                              { name: 'rel', value: 'alternate' },
                            ],
                          } only %}
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                {% endfor %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
    {% include '../ec-component-search-form/search-form.html.twig' with _search_form only %}
  </div>
</header>

{% endspaceless %}
